<!--
  Wrapper data component for list entities
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../gid-api/gid-api.html">

<!--
`gid-list-entities`

The `gid-list-entities` element is a data component acting as a wrapper  on gid-api used for handling rest calls for list entity component.

<gid-list-entities api-url='https://ql50yzu0fj.execute-api.us-east-1.amazonaws.com/dev'
        concept = "100002" application = "100003" database = "100004" schema = "100005" table = "100007"
        entity="COLUMNS" entities={{entities}}></gid-list-entities>
        
If `api-url` is not provided, the component will display sample output for specified entity.

@demo demo/index.html
-->
<dom-module id="gid-list-entities">
    <template>
        <!-- fetch entity url -->
        <gid-api auto=false
                 http-method="GET" api-url={{configUrl}} response='{{configResponse}}'
                 api-timeout={{configTimeout}} api-params={{configParams}}></gid-api>
        <!--  fetch entity url -->

        <!-- entities -->
        <gid-api auto=false
                 http-method="GET" api-url={{entityUrl}} response='{{entityResponse}}'
                 api-timeout={{entityTimeout}} api-params={{entityParams}}></gid-api>
        <!-- entities -->

    </template>
    <script>
        (function () {
            'use strict';
            Polymer({
                is: 'gid-list-entities',
                properties: {
                    entity: {
                        type: String,
                        notify: true,
                        observer: 'entityModified'
                    },
                    apiUrl: {
                        type: String,
                        notify: true,
                        value: ''
                    },
                    entityUrl: {
                        type: String,
                        notify: true
                    },
                    entityTimeout: {
                        type: Number,
                        notify: true,
                        value: 0
                    },
                    entityResponse: {
                        type: Object,
                        notify: true,
                        observer: 'entityResponseChanged'
                    },
                    entityParams: {
                        type: String,
                        notify: true
                    },
                    configUrl: {
                        type: String,
                        notify: true
                    },
                    configTimeout: {
                        type: Number,
                        notify: true,
                        value: 0
                    },
                    configResponse: {
                        type: Object,
                        notify: true,
                        observer: 'configResponseChanged'
                    },
                    configParams: {
                        type: String,
                        notify: true
                    },
                    entities: {
                        type: Array,
                        value: [],
                        notify: true
                    },
                    lob: {
                    	type: String,
                        notify: true,
                        observer: 'entityModified'
                    },
                    concept: {
                        type: String,
                        notify: true,
                        value: '',
                        observer: 'entityModified'
                    },
                    application: {
                    	type: String,
                        notify: true,
                        value: '',
                        observer: 'entityModified'
                    },
                    database: {
                    	type: String,
                        notify: true,
                        value: '',
                        observer: 'entityModified'
                    },
                    schema: {
                    	type: String,
                        notify: true,
                        value: '',
                        observer: 'entityModified'
                    },
                    table: {
                    	type: String,
                        notify: true,
                        value: '',
                        observer: 'entityModified'
                    },
                    apiToken: {
                        type: String,
                        notify: true,
                        value: ''
                    }
                },
                entityResponseChanged: function (newvalue, oldvalue) {
                    console.log(newvalue);
                    this.entities = [];

                    if (newvalue != null) {
                        this.async(function () {
                            this.entities = newvalue[this.entity.toLowerCase()];
                        }, 500);
                    }

                },
//                 entityModified: function () {
//                     if (this.entity) {
//                         this.configUrl = '../assets/config.json';
//                         this.configTimeout =  this.configTimeout - 1;
//                     }
//                 },
                entityModified: function (newvalue, oldvalue) {
                	if (this.entity) {
	                    if (!this.apiUrl) {
	                        this.entityUrl = '../assets/' + this.entity.toLowerCase() + '.json';
	                    } else {
	                    	if(this.entity === "LOBS"){
								 this.entityUrl = this.apiUrl + "/lobs/";
							}
	                    	else if(this.entity === "CONCEPTS"){
	                    		this.entityUrl = this.apiUrl + "/lobs/" + this.lob + "/concepts";
							}
							else if(this.entity === "APPLICATIONS"){
								this.entityUrl = this.apiUrl + "/concepts/" + this.concept + "/applications";
							}
							else if(this.entity === "DATABASES"){
								this.entityUrl = this.apiUrl + "/concepts/" + this.concept + 
												 "/applications/" + this.application + "/databases";
							}
							else if(this.entity === "SCHEMAS"){
								this.entityUrl = this.apiUrl + "/concepts/" + this.concept + 
								 				"/applications/" + this.application + "/databases/" + 
								 				this.database + "/schemas" ;
							}
							else if(this.entity === "TABLES"){
								this.entityUrl = this.apiUrl + "/concepts/" + this.concept + 
								 				"/applications/" + this.application + "/databases/" + 
								 				this.database + "/schemas/"  + this.schema +
								 				"/tables";
							}
							else if(this.entity === "COLUMNS"){
								this.entityUrl = this.apiUrl + "/concepts/" + this.concept + 
								 				"/applications/" + this.application + "/databases/" + 
								 				this.database + "/schemas/"  + this.schema +
								 				"/tables/" + this.table + "/columns";
							}
	                    	this.entityTimeout =  this.entityTimeout - 1;
	                    }
                	}
                }
            });
        })();


    </script>
</dom-module>
